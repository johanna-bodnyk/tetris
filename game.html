<!DOCTYPE html>

<html>
<head>
	<title>You're Playing Tetris!</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>

<body>
	
<!--Set up -->
	<h3>Setup</h3>

	<p>Draw a pit 
		<span id="width"></span> pixels wide by 
		<span id="height"></span> pixels high.
	</p>

<!--Game Play -->
	<h3>Game Play</h3>

	<p>Cube <span id="drop">appears in row 0</span> and <span id="action">...</span></p>

<!--If screen orientation changes-->
	<h3>Orientation Change</h3>

	<p id ="change"></p>

<script>
	var initialOrientation = "";

	// On page load, get the width and height of the browser window,
	// draw a pit of the appropriate dimensions
	// and set initialOrientation to portrait or landscape accordingly

	window.onload = function () {

		width = window.innerWidth;
		height = window.innerHeight;

		document.getElementById('width').innerHTML = width;
		document.getElementById('height').innerHTML = height;

		initialOrientation = (width > height ? "landscape" : "portrait");
	}

	//
	// Swipe and tap detection
	//

	var startX;
	var startY;

	function touchStart(e)
	{
		e.preventDefault();

		var touch = e.changedTouches[0];
		
		startX = touch.clientX;
		startY = touch.clientY;

	}

	function touchEnd(e)
	{
		e.preventDefault();

		var touch = e.changedTouches[0];
		
		endX = touch.clientX;
		endY = touch.clientY;

		changeX = startX-endX;
		changeY = startY-endY;

		if (Math.abs(changeX) < 7 && Math.abs(changeY) < 7) {	// KEEP TESTING THIS THRESHOLD
			action = "rotates clockwise";						// Tap
		}
		else {
			if (Math.abs(changeX) > Math.abs(changeY)) {
				if (changeX > 0) {
					action = "moves left";						// Left swipe
				}
				else {
					action = "moves right";						// Right swipe
				}
			}
			else {
				if (changeY > 0) {
					action = "rotates counter-clockwise";		// Up swipe
				}
				else {
					action = "accelerates down";				// Down swipe
				}
			}
		}

		document.getElementById('action').innerHTML = action;
	}

	// Track whether the browser window orientation changes.
	// Note: We don't care if the phone orientation has changed
	// unless the browser window orientation has also changed. 
	// If the user wants to play while lying in bed, no big deal 
	// as long as she has the device orientation locked --
	// in which case I don't want to interrupt game play.

	function orientationCheck (e) {
		
		// Get current orientation of browser windows

		if (window.matchMedia("(orientation: portrait)").matches) {
			newOrientation = "portrait";
		}
		else {
			newOrientation = "landscape";
		}

		// If the current orientation does not match the initial orientation, pause and alert

		if (initialOrientation != newOrientation) {
			document.getElementById('change').innerHTML = "Your browser window has changed from " + initialOrientation + " to " + newOrientation + ". Please return your device to its original position, lock your screen orientation, or start a new game to play in " + newOrientation + " mode.";
		} 
	}

	window.addEventListener('touchstart', touchStart, false);
	window.addEventListener('touchend', touchEnd, false);
	window.addEventListener('deviceorientation', orientationCheck, false);


</script>
</body>
</html>